"use strict";var renderFilms,genres,inputValue,pageNumber=1,form=document.querySelector(".homePage__form"),input=document.querySelector(".homePage__input"),prevBtn=document.querySelector(".js-prev"),nextBtn=document.querySelector(".js-next"),homePlaginationNumber=document.querySelector(".homepage__page"),list=document.querySelector(".homePage__filmList"),popWhenError=document.querySelector(".homePage__error");function fetchGenres(){fetch("https://api.themoviedb.org/3/genre/movie/list?api_key=f1943ebda4bde31f3353b960641d381f&language=en-US").then(function(e){return e.json()}).then(function(e){genres=e.genres}).catch(function(e){return console.log(e)})}function createCards(e,t,a,n){var r=document.createElement("li");r.classList.add("homePage__filmItem");var i=document.createElement("img");i.classList.add("homePage__img"),i.setAttribute("src","https:/image.tmdb.org/t/p/w500".concat(t));var o=document.createElement("p");o.classList.add("homePage__movieName");var l=getYearFromDate(a);return o.textContent="".concat(e," (").concat(l,")"),r.append(i,o),r.addEventListener("click",function(){return activeDetailsPage(n,!1)}),r}function getYearFromDate(e){return e.slice(0,4)}function getPopularMovies(){var t=document.createDocumentFragment();list.innerHTML="",fetch("https://api.themoviedb.org/3/movie/popular?api_key=f1943ebda4bde31f3353b960641d381f&language=en-US&page=".concat(pageNumber)).then(function(e){return e.json()}).then(function(e){e.results.forEach(function(e){t.append(createCards(e.title,e.backdrop_path,e.release_date,e.id))}),list.append(t),renderFilms=e.results})}function searchFilms(e){e.preventDefault(),inputValue=input.value,fetchMovies(),form.reset()}function fetchMovies(){var t=document.createDocumentFragment();list.innerHTML="",fetch("https://api.themoviedb.org/3/search/movie?api_key=f1943ebda4bde31f3353b960641d381f&language=en-US&page=".concat(pageNumber,"&include_adult=false&query=").concat(inputValue)).then(function(e){return e.json()}).then(function(e){e.results.length<1?popWhenError.classList.remove("main__hidden"):popWhenError.classList.add("main__hidden"),e.results.forEach(function(e){t.append(createCards(e.title,e.backdrop_path,e.release_date,e.id))}),list.append(t),renderFilms=e.results}).catch(function(e){return console.log(e)})}function plaginationNavigation(e){Number(homePlaginationNumber.textContent);"Next"===e.target.textContent&&(pageNumber+=1,homePlaginationNumber.textContent=pageNumber),"Prev"===e.target.textContent&&(pageNumber-=1,homePlaginationNumber.textContent=pageNumber),"1"===homePlaginationNumber.textContent?prevBtn.classList.add("transparent"):prevBtn.classList.remove("transparent"),homePlaginationNumber.textContent<=1&&(prevBtn.disabled=!0),console.log(pageNumber)}function pageAfterLoading(){"1"===homePlaginationNumber.textContent&&prevBtn.classList.add("transparent")}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,a=new Array(e.length);t<e.length;t++)a[t]=e[t];return a}}fetchGenres(),getPopularMovies(),window.onload=pageAfterLoading,prevBtn.addEventListener("click",plaginationNavigation),prevBtn.addEventListener("click",getPopularMovies),nextBtn.addEventListener("click",plaginationNavigation),nextBtn.addEventListener("click",getPopularMovies),form.addEventListener("submit",searchFilms);var homePageBtn=document.querySelector("#homePage-js"),myLibraryPageBtn=document.querySelector("#myLibraryPage-js"),detailsPage=document.querySelector(".detalisPage__block"),myLibraryPage=document.querySelector(".myFilmLibraryPage__block"),homePage=document.querySelector(".homePage__block"),formSearch=document.querySelector(".homePage__form"),homePageBtnLogo=document.querySelector(".header-logo"),selectFilm={},buttonWatch=document.querySelector("#js-buttonWatchedFilms"),buttonQueue=document.querySelector("#js-buttonQueueFilms");function showHomePage(){myLibraryPage.classList.add("main__hidden"),detailsPage.classList.add("main__hidden"),formSearch.classList.remove("main__hidden"),homePage.classList.remove("main__hidden"),homePageBtn.classList.add("nav-list__item-hover"),myLibraryPageBtn.classList.remove("nav-list__item-hover")}function showLibraryPage(){homePage.classList.add("main__hidden"),detailsPage.classList.add("main__hidden"),formSearch.classList.add("main__hidden"),myLibraryPage.classList.remove("main__hidden"),myLibraryPageBtn.classList.add("nav-bar__link-hover"),homePageBtn.classList.remove("nav-bar__link-hover"),buttonWatch.addEventListener("click",drawWatchedFilmList),buttonQueue.addEventListener("click",drawQueueFilmList),drawQueueFilmList()}function activeDetailsPage(t,e){if(homePage.classList.add("main__hidden"),detailsPage.classList.remove("main__hidden"),myLibraryPage.classList.add("main__hidden"),e){var a=[];null!==localStorage.getItem("filmsQueue")&&a.push.apply(a,_toConsumableArray(JSON.parse(localStorage.getItem("filmsQueue")))),null!==localStorage.getItem("filmsWatched")&&a.push.apply(a,_toConsumableArray(JSON.parse(localStorage.getItem("filmsWatched")))),selectFilm=a.find(function(e){return e.id===t})}else selectFilm=renderFilms.find(function(e){return e.id===t});showDetails(selectFilm);var n=document.querySelector("#watch"),r=document.querySelector("#queue");n.addEventListener("click",toggleToWatched),r.addEventListener("click",toggleToQueue),buttonWatch.removeEventListener("click",drawWatchedFilmList),buttonQueue.removeEventListener("click",drawQueueFilmList)}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,a=new Array(e.length);t<e.length;t++)a[t]=e[t];return a}}window.onload=showHomePage(),homePageBtn.addEventListener("click",showHomePage),myLibraryPageBtn.addEventListener("click",showLibraryPage),homePageBtnLogo.addEventListener("click",showHomePage);var detalis=document.querySelector(".detalisPage__block");function monitorButtonStatusText(){var e=document.querySelector(".film-card__icon-queue"),t=document.querySelector(".js-to-queue"),a=document.querySelector(".film-card__icon-watch"),n=document.querySelector(".js-to-watched"),r=JSON.parse(localStorage.getItem("filmsWatched"));null!==r&&(r.find(function(e){return e.id===selectFilm.id})?(a.textContent="ðŸ—‘ï¸",n.textContent="Delete from watched"):(a.textContent="ðŸ“½ï¸",n.textContent="Add to watched"));var i=JSON.parse(localStorage.getItem("filmsQueue"));null!==i&&(i.find(function(e){return e.id===selectFilm.id})?(e.textContent="âž–",t.textContent="Delete from queue"):(e.textContent="âž•",t.textContent="Add to queue"))}function toggleToWatched(){monitorButtonStatusText();var e=[],t=JSON.parse(localStorage.getItem("filmsWatched"));null!==t&&(e=_toConsumableArray(t)),e.find(function(e){return e.id===selectFilm.id})?e=e.filter(function(e){return e.id!==selectFilm.id}):e.push(selectFilm),localStorage.setItem("filmsWatched",JSON.stringify(e)),monitorButtonStatusText()}function toggleToQueue(){monitorButtonStatusText();var e=[],t=JSON.parse(localStorage.getItem("filmsQueue"));null!==t&&(e=_toConsumableArray(t)),e.find(function(e){return e.id===selectFilm.id})?e=e.filter(function(e){return e.id!==selectFilm.id}):e.push(selectFilm),localStorage.setItem("filmsQueue",JSON.stringify(e)),monitorButtonStatusText()}function showDetails(e){detalis.innerHTML="";var t="https://image.tmdb.org/t/p/w500/".concat(e.poster_path);detalis.insertAdjacentHTML("afterbegin",'<div class="film-card">\n    <img src='.concat(t,' alt="film-img" class="film-card__img">\n    <div class="film-card__details">\n<h2 class="film-card__title"> ').concat(e.title,'<span class="film-card__release">').concat(e.release_date.split("-")[0],'</span></h2>\n      <ul class="film-card__info-list info-list">\n        <li class="info-list__item">\n          <p class="info-list__keywords">vote</p>\n          <p class="info-list__value">').concat(e.vote_average,' </p>\n        </li>\n        <li class="info-list__item">\n          <p class="info-list__keywords">popularity</p>\n          <p class="info-list__value">').concat(e.popularity,'</p>\n        </li>\n        <li class="info-list__item">\n          <p class="info-list__keywords">original title</p>\n          <p class="info-list__value">').concat(e.original_title,'</p>\n        </li>\n        <li class="info-list__item">\n          <p class="info-list__keywords">genre</p>\n          <p class="info-list__value">').concat(genres.filter(function(t){return e.genre_ids.find(function(e){return t.id===e})}).reduce(function(e,t){return e+"".concat(t.name," ")},""),'</p>\n        </li>\n      </ul>\n      <div class="film-card__about about">\n        <h2 class="film-card__title">About</h2>\n        <p class="film-card__text">').concat(e.overview,'</p>\n      </div>\n      <ul class="film-card__btn-list">\n        <li class="btn-list__item" id="watch">\n        <span class="film-card__icon-watch"></span>\n          <button type="button" class="btn btn__to-watch js-to-watched" data-action="add" id="watch">Add to watched</button>\n        </li>\n\n        <li class="btn-list__item" id="queue">\n          <span class="film-card__icon-queue"></span>\n          <button type="button" class="btn btn__to-queue js-to-queue">Add to queue</button>\n        </li>\n      </ul>\n    </div>\n  </div>')),monitorButtonStatusText()}var cardLibrary=document.querySelector(".library-list");function drawWatchedFilmList(){buttonWatch.classList.add("library__btn--active"),buttonQueue.classList.remove("library__btn--active"),cardLibrary.innerHTML="";var e=JSON.parse(localStorage.getItem("filmsWatched")),t=document.createDocumentFragment();e.forEach(function(e){return t.append(createLibraryCardFunc(e.title,e.backdrop_path,e.id,e.vote_average))}),cardLibrary.append(t)}function drawQueueFilmList(){buttonWatch.classList.remove("library__btn--active"),buttonQueue.classList.add("library__btn--active"),cardLibrary.innerHTML="";var e=JSON.parse(localStorage.getItem("filmsQueue")),t=document.createDocumentFragment();e.forEach(function(e){return t.append(createLibraryCardFunc(e.title,e.backdrop_path,e.id,e.vote_average))}),cardLibrary.append(t)}function createLibraryCardFunc(e,t,a,n){var r=document.createElement("li");r.classList.add("homePage__filmItem");var i=document.createElement("img");i.classList.add("homePage__img"),i.setAttribute("src","https://image.tmdb.org/t/p/w500".concat(t));var o=document.createElement("p");o.classList.add("homePage__movieName"),o.textContent=e;var l=document.createElement("p");return l.classList.add("library__vote"),l.textContent=n,r.append(i,o,l),r.addEventListener("click",function(){return activeDetailsPage(a,!0)}),r}